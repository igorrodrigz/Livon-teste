<!-- templates/signup.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro - CRUD Livon</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <!-- Incluindo o Vue.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
</head>
<body>
    <header>
        <h1>Cadastro de Usuários</h1>
    </header>
    <main id="app">
        <!-- Formulário gerenciado pelo Vue.js -->
        <form @submit.prevent="submitForm">
            <label for="name">Nome:</label>
            <input type="text" v-model="name" required>

            <label for="email">E-mail:</label>
            <input type="email" v-model="email" required>

            <label for="password">Senha:</label>
            <input type="password" v-model="password" required>

            <label for="confirmPassword">Confirme a Senha:</label>
            <input type="password" v-model="confirmPassword" required>

            <button type="submit">Cadastrar</button>

            <!-- Mensagem de erro se as senhas não coincidirem -->
            <p v-if="errorMessage" style="color: red;">{{ errorMessage }}</p>
        </form>
    </main>

    <script>
        new Vue({
            el: '#app',
            data: {
                name: '',
                email: '',
                password: '',
                confirmPassword: '',
                errorMessage: '' // Armazena mensagem de erro caso as senhas não coincidam
            },
            methods: {
                // Método para processar o envio do formulário
                submitForm() {
                    // Valida se as senhas coincidem
                    if (this.password !== this.confirmPassword) {
                        this.errorMessage = 'As senhas não coincidem!';
                    } else {
                        this.errorMessage = '';
                        // Envio de dados via fetch (ou axios, se preferir) para o backend
                        fetch("{% url 'signup' %}", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': '{{ csrf_token }}' // Necessário para a autenticação Django
                            },
                            body: JSON.stringify({
                                name: this.name,
                                email: this.email,
                                password: this.password
                            })
                        })
                        .then(response => {
                            if (response.ok) {
                                alert("Usuário cadastrado com sucesso!");
                                this.resetForm(); // Limpa os campos do formulário após cadastro
                            } else {
                                this.errorMessage = 'Erro ao cadastrar usuário.';
                            }
                        })
                        .catch(error => {
                            this.errorMessage = 'Erro ao conectar com o servidor.';
                        });
                    }
                },
                // Função para limpar o formulário
                resetForm() {
                    this.name = '';
                    this.email = '';
                    this.password = '';
                    this.confirmPassword = '';
                    this.errorMessage = '';
                }
            }
        });
    </script>
</body>
</html>
